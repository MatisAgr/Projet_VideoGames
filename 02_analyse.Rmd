```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# Chargement des données

```{r load_data}
library(dplyr)
library(lubridate)
library(stringr)
library(ggplot2)

df <- read.csv("games_cleaned.csv", stringsAsFactors = FALSE, encoding = "UTF-8")
df$Release.date <- as.Date(df$Release.date)
df$Year <- year(df$Release.date)
```

# 1. Statistiques descriptives générales

```{r descriptive_stats}
str(df)
summary(df[, c("Price", "Metacritic.score", "User.score", "Positive", "Negative", "Average.playtime.forever")])
```

# 2. Analyse des prix

```{r price_analysis}
df_price <- df %>% filter(!is.na(Price))

mean(df_price$Price, na.rm = TRUE)
median(df_price$Price, na.rm = TRUE)
min(df_price$Price, na.rm = TRUE)
max(df_price$Price, na.rm = TRUE)
sd(df_price$Price, na.rm = TRUE)
sum(df_price$Price == 0, na.rm = TRUE)

ggplot(df_price, aes(x = Price)) +
  geom_histogram(bins = 50, fill = "steelblue", color = "black") +
  xlim(0, 100) +
  labs(title = "Distribution des prix", x = "Prix (€)", y = "Nombre de jeux") +
  theme_minimal()

price_bins <- cut(df_price$Price, breaks = c(0, 10, 20, 30, 50, Inf), labels = c("Gratuit-10€", "10-20€", "20-30€", "30-50€", ">50€"))
price_bin_df <- data.frame(Category = price_bins)
price_bin_df <- price_bin_df %>% filter(!is.na(Category))

ggplot(price_bin_df, aes(x = Category, fill = Category)) +
  geom_bar() +
  labs(title = "Jeux par catégorie de prix", x = "Catégorie", y = "Nombre de jeux") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  guides(fill = "none")
```

# 3. Analyse temporelle

```{r temporal_analysis}
games_by_year <- df %>% group_by(Year) %>% 
  summarise(Count = n(), Avg_Price = mean(Price, na.rm = TRUE), .groups = 'drop')

ggplot(games_by_year, aes(x = Year, y = Count)) +
  geom_line(color = "steelblue", linewidth = 1) +
  geom_point(color = "steelblue", size = 3) +
  labs(title = "Nombre de jeux sortis par année", x = "Année", y = "Nombre de jeux") +
  theme_minimal()

ggplot(games_by_year, aes(x = Year, y = Avg_Price)) +
  geom_line(color = "orange", linewidth = 1) +
  geom_point(color = "orange", size = 3) +
  labs(title = "Prix moyen par année", x = "Année", y = "Prix moyen (€)") +
  theme_minimal()
```

# 4. Analyse des scores

```{r scores_analysis}
df$Metacritic.score <- as.numeric(df$Metacritic.score)
df$User.score <- as.numeric(df$User.score)

mean(df$Metacritic.score, na.rm = TRUE)
median(df$Metacritic.score, na.rm = TRUE)
mean(df$User.score, na.rm = TRUE)
median(df$User.score, na.rm = TRUE)

valid_scores <- df %>% filter(!is.na(Metacritic.score) & !is.na(User.score))
if(nrow(valid_scores) > 0) {
  cor(valid_scores$Metacritic.score, valid_scores$User.score)
}

df_meta <- df %>% filter(!is.na(Metacritic.score))
if(nrow(df_meta) > 0) {
  ggplot(df_meta, aes(x = Metacritic.score)) +
    geom_histogram(bins = 30, fill = "purple", color = "black") +
    labs(title = "Distribution des scores Metacritic", x = "Score", y = "Nombre de jeux") +
    theme_minimal()
}

df_user <- df %>% filter(!is.na(User.score))
if(nrow(df_user) > 0) {
  ggplot(df_user, aes(x = User.score)) +
    geom_histogram(bins = 30, fill = "green", color = "black") +
    labs(title = "Distribution des scores utilisateurs", x = "Score", y = "Nombre de jeux") +
    theme_minimal()
}

if(nrow(valid_scores) > 0) {
  ggplot(valid_scores, aes(x = Metacritic.score, y = User.score)) +
    geom_point(alpha = 0.5, color = "red") +
    geom_smooth(method = "lm", se = TRUE, color = "blue") +
    labs(title = "Corrélation Metacritic vs User Score", x = "Score Metacritic", y = "Score Utilisateur") +
    theme_minimal()
}
```

# 5. Analyse des avis positifs/négatifs

```{r reviews_analysis}
df_reviews <- df %>% filter(!is.na(Positive) & !is.na(Negative))

df_reviews$Total_Reviews <- df_reviews$Positive + df_reviews$Negative
df_reviews$Positive_Ratio <- ifelse(df_reviews$Total_Reviews > 0, df_reviews$Positive / df_reviews$Total_Reviews, NA)

sum(df_reviews$Total_Reviews, na.rm = TRUE)
mean(df_reviews$Positive_Ratio, na.rm = TRUE)
sum(df_reviews$Positive_Ratio > 0.8, na.rm = TRUE)
sum(df_reviews$Positive_Ratio < 0.5, na.rm = TRUE)

df_reviews %>% arrange(desc(Total_Reviews)) %>% slice(1:10) %>% select(Name, Total_Reviews, Positive_Ratio)

df_ratio <- df_reviews %>% filter(!is.na(Positive_Ratio))
ggplot(df_ratio, aes(x = Positive_Ratio)) +
  geom_histogram(bins = 30, fill = "cyan", color = "black") +
  labs(title = "Distribution du ratio d'avis positifs", x = "Ratio positif", y = "Nombre de jeux") +
  theme_minimal()

top_reviewed <- df_reviews %>% arrange(desc(Total_Reviews)) %>% slice(1:15)
if(nrow(top_reviewed) > 0) {
  ggplot(top_reviewed, aes(x = reorder(Name, Total_Reviews), y = Total_Reviews)) +
    geom_bar(stat = "identity", fill = "steelblue") +
    coord_flip() +
    labs(title = "Top 15 jeux les plus commentés", x = "Jeu", y = "Nombre d'avis") +
    theme_minimal()
}
```

# 6. Analyse des plateformes

```{r platform_analysis}
df_plat <- df %>% filter(!is.na(Windows) | !is.na(Mac) | !is.na(Linux))

sum(df_plat$Windows == TRUE, na.rm = TRUE)
sum(df_plat$Mac == TRUE, na.rm = TRUE)
sum(df_plat$Linux == TRUE, na.rm = TRUE)

mean(df_plat$Price[df_plat$Windows == TRUE], na.rm = TRUE)
mean(df_plat$Price[df_plat$Mac == TRUE], na.rm = TRUE)
mean(df_plat$Price[df_plat$Linux == TRUE], na.rm = TRUE)

platforms <- data.frame(
  Plateforme = c("Windows", "Mac", "Linux"),
  Count = c(
    sum(df_plat$Windows == TRUE, na.rm = TRUE),
    sum(df_plat$Mac == TRUE, na.rm = TRUE),
    sum(df_plat$Linux == TRUE, na.rm = TRUE)
  )
)

ggplot(platforms, aes(x = Plateforme, y = Count, fill = Plateforme)) +
  geom_bar(stat = "identity") +
  labs(title = "Nombre de jeux par plateforme", x = "Plateforme", y = "Nombre de jeux") +
  theme_minimal() +
  guides(fill = "none")

platform_price <- data.frame(
  Plateforme = c("Windows", "Mac", "Linux"),
  Prix_Moyen = c(
    mean(df_plat$Price[df_plat$Windows == TRUE], na.rm = TRUE),
    mean(df_plat$Price[df_plat$Mac == TRUE], na.rm = TRUE),
    mean(df_plat$Price[df_plat$Linux == TRUE], na.rm = TRUE)
  )
)

ggplot(platform_price, aes(x = Plateforme, y = Prix_Moyen, fill = Plateforme)) +
  geom_bar(stat = "identity") +
  labs(title = "Prix moyen par plateforme", x = "Plateforme", y = "Prix (€)") +
  theme_minimal() +
  guides(fill = "none")
```

# 7. Analyse des langues

```{r languages_analysis}
df_lang <- df %>% filter(!is.na(Supported.languages))

df_lang$Num_Languages <- sapply(strsplit(df_lang$Supported.languages, ","), length)
mean(df_lang$Num_Languages, na.rm = TRUE)
min(df_lang$Num_Languages, na.rm = TRUE)
max(df_lang$Num_Languages, na.rm = TRUE)

df_lang$Has_Full_Audio <- !is.na(df_lang$Full.audio.languages) & df_lang$Full.audio.languages != ""
sum(df_lang$Has_Full_Audio)
```

# 8. Analyse du temps de jeu

```{r playtime_analysis}
df_playtime <- df %>% filter(!is.na(Average.playtime.forever))

mean(df_playtime$Average.playtime.forever, na.rm = TRUE)
median(df_playtime$Average.playtime.forever, na.rm = TRUE)
max(df_playtime$Average.playtime.forever, na.rm = TRUE)

valid_playtime <- df %>% filter(!is.na(Average.playtime.forever) & !is.na(Price) & Price > 0)
if(nrow(valid_playtime) > 0) {
  cor(valid_playtime$Price, valid_playtime$Average.playtime.forever)
}

df %>% arrange(desc(Average.playtime.forever)) %>% slice(1:10) %>% select(Name, Average.playtime.forever, Price)

ggplot(df_playtime, aes(x = Average.playtime.forever)) +
  geom_histogram(bins = 50, fill = "brown", color = "black") +
  xlim(0, 500) +
  labs(title = "Distribution du temps de jeu moyen", x = "Heures", y = "Nombre de jeux") +
  theme_minimal()

if(nrow(valid_playtime) > 0) {
  ggplot(valid_playtime, aes(x = Price, y = Average.playtime.forever)) +
    geom_point(alpha = 0.5, color = "darkblue") +
    geom_smooth(method = "lm", se = TRUE, color = "red") +
    xlim(0, 100) +
    ylim(0, 500) +
    labs(title = "Corrélation Prix vs Temps de jeu", x = "Prix (€)", y = "Temps de jeu (h)") +
    theme_minimal()
}
```

# 9. Analyse des développeurs/éditeurs

```{r developers_analysis}
df_dev <- df %>% filter(!is.na(Developers))

devs <- strsplit(df_dev$Developers, ",")
dev_names <- unlist(devs)
dev_names <- trimws(dev_names)
dev_counts <- table(dev_names)
sort(dev_counts, decreasing = TRUE)[1:10]
```

# 10. Analyse des recommandations

```{r reviews_count_analysis}
df_total <- df %>% filter(!is.na(Positive) & !is.na(Negative))

df_total$Total_Reviews <- df_total$Positive + df_total$Negative

mean(df_total$Total_Reviews, na.rm = TRUE)
median(df_total$Total_Reviews, na.rm = TRUE)
sum(df_total$Total_Reviews > 0, na.rm = TRUE)

df_total %>% arrange(desc(Total_Reviews)) %>% slice(1:10) %>% select(Name, Total_Reviews, Price, User.score)
```

# 11. Analyse des catégories

```{r categories_analysis}
df_cat <- df %>% filter(!is.na(Categories))

cats <- strsplit(df_cat$Categories, ",")
cat_names <- unlist(cats)
cat_names <- trimws(cat_names)
cat_counts <- table(cat_names)
top_cats <- sort(cat_counts, decreasing = TRUE)[1:15]

top_categories <- data.frame(
  Category = names(top_cats),
  Count = as.numeric(top_cats)
)

ggplot(top_categories, aes(x = reorder(Category, Count), y = Count, fill = Category)) +
  geom_bar(stat = "identity") +
  coord_flip() +
  labs(title = "Top 15 catégories les plus représentées", x = "Catégorie", y = "Nombre de jeux") +
  theme_minimal() +
  guides(fill = "none")
```

# 12. Analyse comparative prix vs qualité

```{r price_quality_analysis}
df_pq <- df %>% filter(!is.na(Price))

df_pq$Price_Category <- cut(df_pq$Price, breaks = c(0, 10, 20, 50, Inf), labels = c("Budget", "Standard", "Premium", "Luxe"))

price_quality <- df_pq %>% 
  filter(!is.na(Price_Category) & !is.na(Metacritic.score)) %>%
  group_by(Price_Category) %>% 
  summarise(
    Avg_Metacritic = mean(Metacritic.score, na.rm = TRUE),
    Avg_User_Score = mean(User.score, na.rm = TRUE),
    Avg_Playtime = mean(Average.playtime.forever, na.rm = TRUE),
    Count = n(),
    .groups = 'drop'
  )

if(nrow(price_quality) > 0) {
  ggplot(price_quality, aes(x = Price_Category, y = Avg_Metacritic, fill = Price_Category)) +
    geom_bar(stat = "identity") +
    labs(title = "Score Metacritic moyen par catégorie de prix", x = "Catégorie", y = "Score") +
    theme_minimal() +
    guides(fill = "none")

  ggplot(price_quality, aes(x = Price_Category, y = Avg_Playtime, fill = Price_Category)) +
    geom_bar(stat = "identity") +
    labs(title = "Temps de jeu moyen par catégorie de prix", x = "Catégorie", y = "Heures") +
    theme_minimal() +
    guides(fill = "none")
}
```

# 13. Analyse des éditeurs

```{r publishers_analysis}
df_pub <- df %>% filter(!is.na(Publishers))

pubs <- strsplit(df_pub$Publishers, ",")
pub_names <- unlist(pubs)
pub_names <- trimws(pub_names)
pub_counts <- table(pub_names)
top_pubs <- sort(pub_counts, decreasing = TRUE)[1:10]

top_publishers <- data.frame(
  Publisher = names(top_pubs),
  Count = as.numeric(top_pubs)
)

ggplot(top_publishers, aes(x = reorder(Publisher, Count), y = Count, fill = Publisher)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() +
  labs(title = "Top 10 éditeurs par nombre de jeux", x = "Éditeur", y = "Nombre de jeux") +
  theme_minimal() +
  guides(fill = "none")
```

# 14. Analyse des plates-formes par année

```{r platform_timeline}
df_plat_time <- df %>% filter(!is.na(Year) & (!is.na(Windows) | !is.na(Mac) | !is.na(Linux)))

platform_by_year <- df_plat_time %>%
  filter(Year >= 2010) %>%
  group_by(Year) %>%
  summarise(
    Windows_Count = sum(Windows == TRUE, na.rm = TRUE),
    Mac_Count = sum(Mac == TRUE, na.rm = TRUE),
    Linux_Count = sum(Linux == TRUE, na.rm = TRUE),
    .groups = 'drop'
  )

if(nrow(platform_by_year) > 0) {
  ggplot(platform_by_year, aes(x = Year)) +
    geom_line(aes(y = Windows_Count, color = "Windows"), linewidth = 1) +
    geom_line(aes(y = Mac_Count, color = "Mac"), linewidth = 1) +
    geom_line(aes(y = Linux_Count, color = "Linux"), linewidth = 1) +
    labs(title = "Évolution du nombre de jeux par plateforme (depuis 2010)", x = "Année", y = "Nombre de jeux", color = "Plateforme") +
    theme_minimal()
}
```

# 15. Analyse de la qualité vs popularité

```{r quality_vs_popularity}
df_qvp <- df %>% filter(!is.na(Metacritic.score) & !is.na(Average.playtime.forever) & Average.playtime.forever > 0)

if(nrow(df_qvp) > 0) {
  ggplot(df_qvp, aes(x = Metacritic.score, y = Average.playtime.forever, color = Price)) +
    geom_point(alpha = 0.4, size = 2) +
    geom_smooth(method = "lm", se = FALSE, color = "red", linewidth = 1) +
    ylim(0, 1000) +
    labs(title = "Score Metacritic vs Temps de jeu moyen", x = "Score Metacritic", y = "Temps de jeu moyen (heures)", color = "Prix (€)") +
    theme_minimal() +
    scale_color_gradient(low = "lightgreen", high = "darkred")
}
```
